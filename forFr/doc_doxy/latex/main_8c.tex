\hypertarget{main_8c}{}\section{Р¤Р°Р№Р» main.\+c}
\label{main_8c}\index{main.\+c@{main.\+c}}


Программа работы с АЦП и ЦАП  


{\ttfamily \#include \char`\"{}main.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}stm32f4xx\+\_\+hal.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}usb\+\_\+device.\+h\char`\"{}}\newline
\subsection*{Р¤СѓРЅРєС†РёРё}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8c_a70af21c671abfcc773614a9a4f63d920}{System\+Clock\+\_\+\+Config}} (void)
\begin{DoxyCompactList}\small\item\em System Clock Configuration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a38ad4725462bdc5e86c4ead4f04b9fc2}{T\+I\+M2\+\_\+\+I\+R\+Q\+Handler}} (void)
\begin{DoxyCompactList}\small\item\em обработчик прерывания T\+I\+M2 \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a98cff83252098363b2dbca9608df964e}{T\+I\+M7\+\_\+\+I\+R\+Q\+Handler}} (void)
\begin{DoxyCompactList}\small\item\em обработчик прерывания T\+I\+M7 \end{DoxyCompactList}\item 
int \mbox{\hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\begin{DoxyCompactList}\small\item\em The application entry point. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a829116a51f1db1a72ebd1120f60719d5}{\+\_\+\+Error\+\_\+\+Handler}} (char $\ast$file, int line)
\begin{DoxyCompactList}\small\item\em This function is executed in case of error occurrence. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{РџРµСЂРµРјРµРЅРЅС‹Рµ}
\begin{DoxyCompactItemize}
\item 
A\+D\+C\+\_\+\+Handle\+Type\+Def \mbox{\hyperlink{main_8c_a22b804736f5648d52f639b2647d4ed13}{hadc1}}
\item 
D\+M\+A\+\_\+\+Handle\+Type\+Def \mbox{\hyperlink{main_8c_a1c126854bb1813d31ab4776b21dcc51f}{hdma\+\_\+adc1}}
\item 
T\+I\+M\+\_\+\+Handle\+Type\+Def \mbox{\hyperlink{main_8c_a2c80fd5510e2990a59a5c90d745c716c}{htim2}}
\item 
T\+I\+M\+\_\+\+Handle\+Type\+Def \mbox{\hyperlink{main_8c_abb71bf3ee68e2a051fbeec6c3ab3012d}{htim7}}
\item 
uint16\+\_\+t \mbox{\hyperlink{main_8c_a9d44728297464a08d38c2735cebebbcb}{A\+D\+C\+\_\+\+Data}}
\begin{DoxyCompactList}\small\item\em переменная с результатами измерения \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{main_8c_af6f6b098dc121d00f74f3e7e2b2b35bb}{summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA}} =0
\begin{DoxyCompactList}\small\item\em рабочая переменная для накапливания суммы результатов измерений \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{main_8c_af735140bd99169a010349f48f905fdbd}{cnt\+\_\+adc}} =0
\begin{DoxyCompactList}\small\item\em количество произведённых измерений \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{main_8c_a8f06df258f74353da7fb3dc9d9bfd54f}{srednee}}
\begin{DoxyCompactList}\small\item\em расчитаное значение с АЦП \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{main_8c_aa8c308071fb2d34a26754ec3434dec7b}{send\+Data}} =0
\begin{DoxyCompactList}\small\item\em флаг на передачу значений \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{РџРѕРґСЂРѕР±РЅРѕРµ РѕРїРёСЃР°РЅРёРµ}
Программа работы с АЦП и ЦАП 

1) Подключен виртуальный ком-\/порт 2) считаны значения с АЦП 3) переданы значение в ЦАП 4) переданы значение по S\+WD 5) среднее расчитан и передано 

\subsection{Р¤СѓРЅРєС†РёРё}
\mbox{\Hypertarget{main_8c_a829116a51f1db1a72ebd1120f60719d5}\label{main_8c_a829116a51f1db1a72ebd1120f60719d5}} 
\index{main.\+c@{main.\+c}!\+\_\+\+Error\+\_\+\+Handler@{\+\_\+\+Error\+\_\+\+Handler}}
\index{\+\_\+\+Error\+\_\+\+Handler@{\+\_\+\+Error\+\_\+\+Handler}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{\+\_\+\+Error\+\_\+\+Handler()}{\_Error\_Handler()}}
{\footnotesize\ttfamily void \+\_\+\+Error\+\_\+\+Handler (\begin{DoxyParamCaption}\item[{char $\ast$}]{file,  }\item[{int}]{line }\end{DoxyParamCaption})}



This function is executed in case of error occurrence. 


\begin{DoxyParams}{РђСЂРіСѓРјРµРЅС‚С‹}
{\em file} & The file name as string. \\
\hline
{\em line} & The line in file as a number. \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Р’РѕР·РІСЂР°С‰Р°РµРјС‹Рµ Р·РЅР°С‡РµРЅРёСЏ}
{\em None} & \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}\label{main_8c_a840291bc02cba5474a4cb46a9b9566fe}} 
\index{main.\+c@{main.\+c}!main@{main}}
\index{main@{main}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



The application entry point. 


\begin{DoxyRetVals}{Р’РѕР·РІСЂР°С‰Р°РµРјС‹Рµ Р·РЅР°С‡РµРЅРёСЏ}
{\em None} & \\
\hline
\end{DoxyRetVals}
стартуем таймера ~\newline
~\newline
~\newline
~\newline
~\newline
~\newline
~\newline
~\newline
~\newline
 старт передачи данных с АЦП через D\+MA

следующая строчка оставлена на случай передачи значений в ЦАП черех D\+MA с использованием H\+AL

включаем ЦАП

передача значени в ЦАП

если взведён флаг

формируем строку

и передаём её через S\+WD

и виртуальный C\+O\+M-\/порт

сбрасываем флаг \mbox{\Hypertarget{main_8c_a70af21c671abfcc773614a9a4f63d920}\label{main_8c_a70af21c671abfcc773614a9a4f63d920}} 
\index{main.\+c@{main.\+c}!System\+Clock\+\_\+\+Config@{System\+Clock\+\_\+\+Config}}
\index{System\+Clock\+\_\+\+Config@{System\+Clock\+\_\+\+Config}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{System\+Clock\+\_\+\+Config()}{SystemClock\_Config()}}
{\footnotesize\ttfamily void System\+Clock\+\_\+\+Config (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



System Clock Configuration. 


\begin{DoxyRetVals}{Р’РѕР·РІСЂР°С‰Р°РµРјС‹Рµ Р·РЅР°С‡РµРЅРёСЏ}
{\em None} & \\
\hline
\end{DoxyRetVals}
Configure the main internal regulator output voltage

Initializes the C\+PU, A\+HB and A\+PB busses clocks

Initializes the C\+PU, A\+HB and A\+PB busses clocks

Configure the Systick interrupt time

Configure the Systick\mbox{\Hypertarget{main_8c_a38ad4725462bdc5e86c4ead4f04b9fc2}\label{main_8c_a38ad4725462bdc5e86c4ead4f04b9fc2}} 
\index{main.\+c@{main.\+c}!T\+I\+M2\+\_\+\+I\+R\+Q\+Handler@{T\+I\+M2\+\_\+\+I\+R\+Q\+Handler}}
\index{T\+I\+M2\+\_\+\+I\+R\+Q\+Handler@{T\+I\+M2\+\_\+\+I\+R\+Q\+Handler}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{T\+I\+M2\+\_\+\+I\+R\+Q\+Handler()}{TIM2\_IRQHandler()}}
{\footnotesize\ttfamily void T\+I\+M2\+\_\+\+I\+R\+Q\+Handler (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



обработчик прерывания T\+I\+M2 


\begin{DoxyRetVals}{Р’РѕР·РІСЂР°С‰Р°РµРјС‹Рµ Р·РЅР°С‡РµРЅРёСЏ}
{\em None} & прерывания от таймера -\/ есть тригер для АЦП\\
\hline
\end{DoxyRetVals}
вынесено в \mbox{\hyperlink{main_8c}{main.\+c}} лишь для удобства так как проект небольшой накапливаем измеренные значения

инкрементируем счёт измерений \mbox{\Hypertarget{main_8c_a98cff83252098363b2dbca9608df964e}\label{main_8c_a98cff83252098363b2dbca9608df964e}} 
\index{main.\+c@{main.\+c}!T\+I\+M7\+\_\+\+I\+R\+Q\+Handler@{T\+I\+M7\+\_\+\+I\+R\+Q\+Handler}}
\index{T\+I\+M7\+\_\+\+I\+R\+Q\+Handler@{T\+I\+M7\+\_\+\+I\+R\+Q\+Handler}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{T\+I\+M7\+\_\+\+I\+R\+Q\+Handler()}{TIM7\_IRQHandler()}}
{\footnotesize\ttfamily void T\+I\+M7\+\_\+\+I\+R\+Q\+Handler (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



обработчик прерывания T\+I\+M7 


\begin{DoxyRetVals}{Р’РѕР·РІСЂР°С‰Р°РµРјС‹Рµ Р·РЅР°С‡РµРЅРёСЏ}
{\em None} & по прерыванию рассчитывается усреднённое значение и взводится флаг на отправку данных через C\+OM и S\+WD\\
\hline
\end{DoxyRetVals}
вынесено в \mbox{\hyperlink{main_8c}{main.\+c}} лишь для удобства так как проект небольшой при 4095 соответствующем 3.\+3В, то значение в мВ\+: 

\subsection{РџРµСЂРµРјРµРЅРЅС‹Рµ}
\mbox{\Hypertarget{main_8c_a9d44728297464a08d38c2735cebebbcb}\label{main_8c_a9d44728297464a08d38c2735cebebbcb}} 
\index{main.\+c@{main.\+c}!A\+D\+C\+\_\+\+Data@{A\+D\+C\+\_\+\+Data}}
\index{A\+D\+C\+\_\+\+Data@{A\+D\+C\+\_\+\+Data}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{A\+D\+C\+\_\+\+Data}{ADC\_Data}}
{\footnotesize\ttfamily uint16\+\_\+t A\+D\+C\+\_\+\+Data}



переменная с результатами измерения 

\mbox{\Hypertarget{main_8c_af735140bd99169a010349f48f905fdbd}\label{main_8c_af735140bd99169a010349f48f905fdbd}} 
\index{main.\+c@{main.\+c}!cnt\+\_\+adc@{cnt\+\_\+adc}}
\index{cnt\+\_\+adc@{cnt\+\_\+adc}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{cnt\+\_\+adc}{cnt\_adc}}
{\footnotesize\ttfamily uint32\+\_\+t cnt\+\_\+adc =0}



количество произведённых измерений 

\mbox{\Hypertarget{main_8c_a22b804736f5648d52f639b2647d4ed13}\label{main_8c_a22b804736f5648d52f639b2647d4ed13}} 
\index{main.\+c@{main.\+c}!hadc1@{hadc1}}
\index{hadc1@{hadc1}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{hadc1}{hadc1}}
{\footnotesize\ttfamily A\+D\+C\+\_\+\+Handle\+Type\+Def hadc1}

\mbox{\Hypertarget{main_8c_a1c126854bb1813d31ab4776b21dcc51f}\label{main_8c_a1c126854bb1813d31ab4776b21dcc51f}} 
\index{main.\+c@{main.\+c}!hdma\+\_\+adc1@{hdma\+\_\+adc1}}
\index{hdma\+\_\+adc1@{hdma\+\_\+adc1}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{hdma\+\_\+adc1}{hdma\_adc1}}
{\footnotesize\ttfamily D\+M\+A\+\_\+\+Handle\+Type\+Def hdma\+\_\+adc1}

\mbox{\Hypertarget{main_8c_a2c80fd5510e2990a59a5c90d745c716c}\label{main_8c_a2c80fd5510e2990a59a5c90d745c716c}} 
\index{main.\+c@{main.\+c}!htim2@{htim2}}
\index{htim2@{htim2}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{htim2}{htim2}}
{\footnotesize\ttfamily T\+I\+M\+\_\+\+Handle\+Type\+Def htim2}

\mbox{\Hypertarget{main_8c_abb71bf3ee68e2a051fbeec6c3ab3012d}\label{main_8c_abb71bf3ee68e2a051fbeec6c3ab3012d}} 
\index{main.\+c@{main.\+c}!htim7@{htim7}}
\index{htim7@{htim7}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{htim7}{htim7}}
{\footnotesize\ttfamily T\+I\+M\+\_\+\+Handle\+Type\+Def htim7}

\mbox{\Hypertarget{main_8c_aa8c308071fb2d34a26754ec3434dec7b}\label{main_8c_aa8c308071fb2d34a26754ec3434dec7b}} 
\index{main.\+c@{main.\+c}!send\+Data@{send\+Data}}
\index{send\+Data@{send\+Data}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{send\+Data}{sendData}}
{\footnotesize\ttfamily uint8\+\_\+t send\+Data =0}



флаг на передачу значений 

\mbox{\Hypertarget{main_8c_a8f06df258f74353da7fb3dc9d9bfd54f}\label{main_8c_a8f06df258f74353da7fb3dc9d9bfd54f}} 
\index{main.\+c@{main.\+c}!srednee@{srednee}}
\index{srednee@{srednee}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{srednee}{srednee}}
{\footnotesize\ttfamily uint32\+\_\+t srednee}



расчитаное значение с АЦП 

\mbox{\Hypertarget{main_8c_af6f6b098dc121d00f74f3e7e2b2b35bb}\label{main_8c_af6f6b098dc121d00f74f3e7e2b2b35bb}} 
\index{main.\+c@{main.\+c}!summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA@{summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA}}
\index{summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA@{summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA}{summ\_ADC\_DATA}}
{\footnotesize\ttfamily uint32\+\_\+t summ\+\_\+\+A\+D\+C\+\_\+\+D\+A\+TA =0}



рабочая переменная для накапливания суммы результатов измерений 

